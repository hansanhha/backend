## [12가지 요소](https://12factor.net/) 방법론

Heroku 클라우드 플랫폼을 만든 사람들이 정립한 애플리케이션 개발 원칙 중 유익한 것을 모아서 정리한 요소들

## 애플리케이션을 만들 때 필요한 핵심 사상

- 선언적 형식으로 설정을 자동화해서 프로젝트에 참여하는 동료가 적응하는 데 필요한 시간과 비용을 최소화한다
- 운영체제에 구애받지 않는 투명한 계약을 통해 다양한 실행 환경에서 작동할 수 있도록 이식성을 극대화한다
- 현대적인 클라우드 플랫폼 기반 개발을 통해 서버와 시스템 관리에 대한 부담을 줄인다
- 개발과 운영의 간극을 최소화해서 지속적 배포를 가능하게 하고 애자일성을 최대화한다
- 도구, 아키텍처, 개발 관행을 크게 바꾸지 않아도 서비스 규모 수직적 확장이 가능하다

## 핵심 사상을 바탕으로 한 제약 조건 12요소

| 12요소                | 설명                                      |
|---------------------|-----------------------------------------|
| Codebase            | 버전 관리되는 하나의 코드베이스가 여러 번 배포된다            |
| Dependencies        | 의존관계는 명시적으로 표시하고 격리한다                   |
| Config              | 설정 정보는 실행 환경에 저장한다                      |
| Backing Services    | 지원 서비스는 필요에 따라 추가되는 자원으로 취급한다           |
| Build, Release, Run | 빌드와 릴리스, 실행 단계는 엄격하게 분리한다               |
| Processes           | 애플리케이션은 하나 이상의 무상태 프로세스로 실행한다           |
| Port binding        | 서비스는 포트에 연결해서 외부에 공개한다                  |
| Concurrency         | 프로세스 모델을 통해 수평적으로 확장한다                  |
| Disposability       | 빠른 시작과 깔끔한 종료로 견고함을 극대화한다               |
| Dev/prod parity     | 개발과 스테이징, 운영은 가능한 한 동일하게 유지한다           |
| Logs                | 로그는 이벤트 스트림으로 취급한다                      |
| Admin Process       | 관리(admin/management) 작업은 일회성 프로세스로 실행한다 |

**Codebase** (버전 관리되는 하나의 코드베이스가 여러 번 배포된다)
- 소스 코드 저장소에는 의존관계를 나타내는 `manifest`를 가지고 있는 하나의 애플리케이션이 포함되어 있어야 함
- 실행 환경이 달라질 때마다 애플리케이션을 다시 컴파일하거나 패키지 구조를 변경할 필요가 없어야 함
- 즉, 한 번만 빌드되면 여러 실행 환경(Dev, QA, Staging, Production)에 배포될 수 있어야 함

**Dependencies** (의존관계는 명시적으로 표시하고 격리한다)
- 모든 의존 관계는 manifest 파일에 명시적으로 표시되어야 함
- 애플리케이션 필요한 모든 의존 관계는 maven, gradle 같은 의존관계 관리 도구를 써서 라이브러리 저장소에서 내려받을 수 있어야 함

**Config** (설정 정보는 실행 환경에 저장한다)
- 애플리케이션 코드는 설정 정보(Configuration)과 완전히 분리되어야 함
- 애플리케이션의 설정 정보는 실행 환경에서 읽어올 수 있어야 함
- 외부 연결에 필요한 정보, 인증 정보, 연결 대상 웹 서비스의 호스트 이름을 환경 변수로 저장하면 환경 설정 파일을 다시 배포할 필요없이 실행 환경의 환경 변수에서 읽어올 수 있음
- 실행 환경에 따라 달라지는 모든 값은 환경 설정 정보로 분류해서 그 환경에 저장하고, 애플리케이션에 포함하지 않는다 (설정 정보 외부화)

**Backing Services** (지원 서비스는 필요에 따라 추가되는 자원으로 취급한다)
- 12 요소 애플리케이션이 일반적인 작업을 수행할 때 사용하는 서비스
- 데이터베이스, RESTful 웹 서비스, SMTP 서버, FTP 서버 등
- Backing Service는 애플리케이션의 자원으로 간주함
- 자원은 애플리케이션이 운영되는 동안 애플리케이션에 추가됨
- 12 요소 애플리케이션은 소스 코드를 변경하지 않고도, 테스팅 환경에서 사용하던 DBMS를 스테이징 환경에선 다른 DBMS로 변경할 수 있어야 함

**Build, Release, Run** (빌드와 릴리스, 실행 단계는 엄격하게 분리한다)
- Build 단계 
  - 애플리케이션 소스 코드를 가져와서 필요 시 컴파일을 한 후, 하나의 패키지로 만듦
  - 이렇게 만들어진 패키지를 **빌드(build)**라고 함
- Release 단계
  - 빌드에 환경설정 정보를 조합함
  - 배포를 위해 생성된 릴리즈 버전은 실행 환경에서 운영될 수 있는 준비가 완료됨
  - 또한 시맨틱 버저닝 또는 타임스탬프를 통해 유일한 식별자가 부여됨
  - 릴리즈 버전은 특정 디렉토리에 저장되어 나중에 릴리즈 관리 도구를 통해 이전 버전으로 롤백하는 데 사용됨
- Run 단계
  - 런타임 단계로써, 릴리즈 버전 중에 하나를 선택해서 실행 환경 위에서 애플리케이션을 실행함

각 단계를 별개의 프로세스로 분리하면 런타임에 애플리케이션 코드를 변경할 수 없음

변경하는 방법은 빌드 단계부터 새로운 릴리즈 버전을 만들던가, 이전 버전으로의 롤백밖에 없음

**Processes** (애플리케이션은 하나 이상의 무상태 프로세스로 실행한다)
- 12요소 애플리케이션은 무공유(share-nothing) 아키텍처 위에서 상태를 갖지 않는(stateless) 방식으로 만들어짐
- 애플리케이션은 Backing Service를 통해서만 영속성(persistence)을 가질 수 있음 - 데이터베이스, 객체 스토어(Object Store)
- 모든 자원은 Backing Service로서 런타임 시에 애플리케이션에 추가됨
- 애플리케이션의 실행 환경을 모두 제거하고 다시 만들었을 때 데이터 유실이 발생하는 경우 애플리케이션이 상태를 보유하고 있는 것으로 판단할 수 있음

**Port binding** (서비스는 포트에 연결해서 외부에 공개한다)
- 12요소 애플리케이션은 스스로 웹 서버를 포함하고 있어서 완전히 자기 완비적(self-contained)임
- 각 애플리케이션은 특정 HTTP 포트에 연결되어 외부에 공개됨
- 라우팅 계층은 외부에 공개된 호스트 이름으로 유입되는 요청을 HTTP 포트 기준으로 분류해서 해당 애플리케이션 실행 환경으로 전송

**Concurrency** (프로세스 모델을 통해 수평적으로 확장한다)
- 애플리케이션은 필요할 때마다 프로세스나 스레드를 수평적으로 확장해서 병렬로 실행할 수 있어야 함
- 장시간 소요되는 데이터 처리 작업은 동시 실행 가능한 작업을 스레드풀에 할당해서 비동기적으로 실행해주는 스레드 실행기를 통해 수행되어야 함
- 애플리케이션이 상태를 갖지 않으면 수평적 확장을 통해 더 많은 요청을 나눠 처리할 수 있음

**Disposability** (빠른 시작과 깔끔한 종료로 견고함을 극대화한다)
- 12요소 애플리케이션 프로세스는 실행 중 쉽게 중지될 수 있어야 함
- 중지될 때 처리되어야 하는 작업을 모두 수행한 후 다음 깔끔하게 종료됨
- 애플리케이션 프로세스는 가능한 한 짧은 시간 내에 시작되어야 함
- 시작 시간이 짧을수록 부하가 증가하는 경우 수평적으로 확장하는 데 필요한 시간을 줄여줌
- 반면 오래 걸릴수록 대규모 트래픽 급증에 대처하는 가용성이 떨어짐

**Dev/prod parity** (개발과 스테이징, 운영은 가능한 한 동일하게 유지한다)
- 개발 환경과 운영 환경을 가능한 한 동일하게 유지하는 짝맞춤(parity)을 통해 분기(divergence)를 예방할 수 있어야 함
- 차이가 발생하는 부분
  - 시간 차이: 개발자는 변경 사항을 운영 환경에 빨리 배포
  - 개인 차이: 코드 변경을 맡은 개발자는 운영 환경으로서의 배포 작업까지 할 수 있어야 하고, 변경 반영 후 애플리케이션 모니터링도 할 수 있어야 함
  - 도구 차이: 작은 불일치로 발생하는 예상하지 못한 동작을 미연에 방지하기 위해 각 실행 환경에 사용된 기술이나 프레임워크는 동일하게 구성되어야 함

**Logs** (로그는 이벤트 스트림으로 취급한다)
- 12요소 애플리케이션은 시간에 따른 이벤트로서 stdout에 로그를 남김
- 애플리케이션은 로그 파일 저장에 관여하지 말아야 함
- 로그 집계와 저장은 애플리케이션이 아니라 실행 환경에 의해 처리되어야 함

**Admin Process** (관리(admin/management) 작업은 일회성 프로세스로 실행한다)
- Admin Process: 데이터베이스 마이그레이션, 일회성 스크립트 등
- 애플리케이션의 실행 환경에서 실행되어야 하고, 스크립트는 실행 환경 간 일관성 유지를 위해 소스 코드 저장소에 포함되어야 함